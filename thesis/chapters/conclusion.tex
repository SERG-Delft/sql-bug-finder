\chapter{Conclusion}
\label{chapter:conclusion}

SQL is the most widely used database language, with more than 70\% of developers actively using it, as noted in a previous study \cite{P999}, however there is lacking support for detecting semantic issues, also known as code smells, in SQL queries. This is especially worrying seeing the high popularity of this language and its wide adoption in numerous industries, therefore the impact of potential problems with such queries can not be overstated.

Our goal with this thesis is two-fold. First, we propose a set of 25 validated heuristics for detecting the most common types of semantic bugs which appear in SQL queries, based on evidence from previous research. Second, we conduct an empirical study on the prevalence of semantic bugs in SQL using two datasets with queries extracted from three open-source projects as well as 190000+ queries collected from StackOverflow posts, building the largest collection of SQL queries to our knowledge. The correctness of the heuristics was manually verified from a random sample of more than 500 queries. 

We also provide a prototype implementation for a rule based static analysis tool, containing our 25 heuristics, for detecting semantic bugs. Our tool is able to detect semantic bugs in SQL queries with a 97\% accuracy. Furthermore, we observed that out of all the 191994 collected queries, 36818 contain at least one semantic bug, which means that 19.17\% of queries contained some semantic problem in their formulation. 

Analysing the prevalence of semantic bugs in SQL queries, we find that the most common bugs are missing join predicates (\sql{E019}) followed by the constant output column (\sql{E002}) and unnecessary count argument (\sql{E012}) bugs. We also found out that co-occurrence of semantic issues in SQL queries for our entire dataset is rather low, indicating that queries rarely contain more than one semantic bug. The highest similarity between two issues is 20\%, for the unnecessary count argument (\sql{E012}) and unnecessary group by attribute (\sql{E013}). 

Also quite interesting, we show that more complex queries, in terms of number of joins, predicates and functions used, tend to suffer from more semantic bugs, an interesting finding which could be used in the future as a metric for early prediction as to whether a query might contain semantic bugs or not.


\section{Recommendations}

In this section, we give some recommendations for developers, tool makers and researchers based on the findings made in our research.\\

\noindent \textbf{Recommendations for developers.} With so many applications relying on SQL for querying purposes, now more than ever it is crucial for developers to understand the implications of their queries suffering from various semantic issues. As we show in our empirical study, there are already quite a number of queries being shared online which already suffer from these types of problems, as it can be seen from Figure \ref{fig:prevalence}. Developers should therefore try to familiarize themselves not only with these semantic issues and how they appear when working with SQL, but they should also pay more attention to trying to detect these issues as well as address them as soon as they are discovered, just as bad code smells are addressed as well.\\

\noindent \textbf{Recommendations for tool makers.} The main focus here should be placed on designing tools for mass adoption. Choosing this as the main driving factor when building new tools should help with making sure that developers actually see value in the tool. More specifically, our findings show that it is currently hard for developers to check their SQL queries for semantic issues due to one underlying problem, which is the lack of adequate tools and support. Current implementations of tools that integrate with IDEs are lacking a lot when it comes to support for detecting semantic issues for queries, furthermore, there are also no tools, to our knowledge, which are integrated with popular development frameworks (such as SpringBoot) for checking these types of issues during application runtime. Especially interesting for future tools could be to integrate issue detection based on similarity measures, as we show in Figure \ref{fig:matrix} as well as early warnings based on metrics such as query complexity as we present in Figure \ref{fig:complexity_box}.\\

\noindent \textbf{Recommendations for researchers.} Based on the findings made when carrying out this study, we can say that current research places more focus on trying to develop techniques and methods for identifying syntactic issues in SQL queries. However, as we show in this paper and as well as other studies have pointed out, more emphasis should be placed on detecting semantic issues in queries as well. With implications ranging from performance issues to security vulnerabilities, having these types of semantic errors in any system is definitely detrimental. Therefore, it is quite crucial that in the near future, more research involving semantic issue detection for SQL will be carried out.


\section{Future work}

In this section we discuss the possible improvements that could be made to our detection tool as well as the query extraction algorithm and provide some ideas for future research which could make use of our large-scale SQL query dataset.

\begin{itemize}
    \item \textbf{Integrate the rule-based static analysis tool for detecting semantic issues in SQL queries into an IntelliJ/Eclipse plugin.} By providing support for our tool as an IDE plugin, developers can take advantage of it more easily. Other benefits could be real time detection of issues, when queries are written in the IDE as well as during runtime, when the application is executed, as an integration with the SpringBoot framework.
    \item \textbf{Improve the query extraction algorithm.} For retrieving queries from StackOverflow it would be interesting to investigate whether better results (more queries extracted) could be achieved by using a tool such as GitHubâ€™s linguist\footnote{\url{https://github.com/github/linguist}} or Guesslang\footnote{\url{https://github.com/yoeo/guesslang}} for determining the programming language from within a code snippet.
    \item \textbf{Use our dataset to investigate whether developers notice SQL semantic issues in StackOverflow posts.} It would be interesting to analyse in future studies whether developers notice various types of semantic issues when either asking or replying to questions on StackOverflow. Another potential avenue for research could be to investigate the evolution of posts which might suffer from semantic issues in time and see if the problems are addressed.
    \item \textbf{Improve the rule-based static analysis tool by expanding the number of semantic issues which can be detected.} Although the tool is able to already detect the most common types of semantic issues which might occur in SQL queries, it would be very interesting to keep expanding this list by including other issues as well, such as the ones present in the closed source tool SQLEnlight. There is a comprehensive list\footnote{\url{https://sqlenlight.com/support/help/analysis-rules/}} with some of the semantic rules which this tool supports, so in the future one could port these into our detection tool as well.
\end{itemize}

